<!DOCTYPE html>
<html>
<head>
    <title>调试页面 - 二维码生成测试</title>
</head>
<body>
    <h1>调试页面 - 二维码生成测试</h1>
    
    <h2>1. 系统信息API测试</h2>
    <div id="system-info"></div>
    
    <h2>2. 二维码API测试</h2>
    <div id="qr-test"></div>
    
    <h2>3. 图片显示测试</h2>
    <div id="qr-image"></div>

    <script>
        async function debugSystem() {
            try {
                // 1. 获取系统信息
                const systemResponse = await fetch('http://localhost:7070/api/system/info');
                const systemData = await systemResponse.json();
                
                document.getElementById('system-info').innerHTML = `
                    <h3>系统信息:</h3>
                    <p><strong>推荐IP:</strong> ${systemData.recommended_ip}</p>
                    <p><strong>端口:</strong> ${systemData.port}</p>
                    <p><strong>可用IP列表:</strong></p>
                    <ul>
                        ${systemData.available_ips.map(ip => 
                            `<li>${ip.ip} - ${ip.name} (${ip.type})</li>`
                        ).join('')}
                    </ul>
                `;

                // 2. 测试二维码生成
                const testIP = systemData.recommended_ip || '192.168.0.127';
                const qrResponse = await fetch('http://localhost:7070/api/system/qrcode', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        ip: testIP,
                        port: systemData.port || 7070
                    })
                });
                
                const qrData = await qrResponse.json();
                
                document.getElementById('qr-test').innerHTML = `
                    <h3>二维码API响应:</h3>
                    <p><strong>URL:</strong> ${qrData.url}</p>
                    <p><strong>二维码数据:</strong> ${qrData.qr_code.substring(0, 50)}...</p>
                `;

                // 3. 显示二维码图片
                const img = document.createElement('img');
                img.src = qrData.qr_code;
                img.alt = `二维码: ${qrData.url}`;
                img.style.maxWidth = '200px';
                document.getElementById('qr-image').appendChild(img);

            } catch (error) {
                document.getElementById('system-info').innerHTML = `
                    <p style="color: red;">错误: ${error.message}</p>
                `;
            }
        }

        // 页面加载完成后执行调试
        debugSystem();
    </script>
</body>
</html>